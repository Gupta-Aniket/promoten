## ðŸ“‚ Project Structure

```
â””â”€â”€ ./
    â”œâ”€â”€ bindings/
    â”‚   â””â”€â”€ project_binding.dart
    â”œâ”€â”€ controllers/
    â”‚   â”œâ”€â”€ project_controller.dart
    â”‚   â””â”€â”€ question_controller.dart
    â”œâ”€â”€ main.dart
    â”œâ”€â”€ models/
    â”‚   â””â”€â”€ question_model.dart
    â”œâ”€â”€ services/
    â”‚   â””â”€â”€ api_service.dart
    â””â”€â”€ views/
        â”œâ”€â”€ api_setup_screen.dart
        â”œâ”€â”€ project_input_screen.dart
        â”œâ”€â”€ question_screen.dart
        â””â”€â”€ result_screen.dart
```

### project_binding.dart
```dart
import 'package:get/get.dart';
import '../controllers/project_controller.dart';

class ProjectBinding extends Bindings {
  @override
  void dependencies() {
    Get.put(ProjectController());
  }
}

```

### project_controller.dart
```dart
import 'dart:convert';
import 'package:flutter/material.dart';
import 'package:get/get.dart';
  import 'package:shared_preferences/shared_preferences.dart';
class ProjectController extends GetxController {
@override
  void onInit() {
    loadPreferences();
    super.onInit();
  }

  // Text controllers for project input
  final titleController = TextEditingController();
  final descriptionController = TextEditingController();
  final githubController = TextEditingController();
  final liveLinkController = TextEditingController();
  final linkedinController = TextEditingController();
  final portfolioController = TextEditingController();
  RxList<String> base64Images = <String>[].obs;


  // Observables for selected images (4 max)
  RxList<String?> selectedImages = RxList.filled(4, null);

  // Clarifying questions generated by LLM
  RxList<String> clarifyingQuestions = <String>[].obs;

  // Answers to the questions (indexed)
  RxMap<int, String> questionAnswers = <int, String>{}.obs;

  // Saved social handles (loaded from local storage later)
  RxString savedLinkedIn = ''.obs;
  RxString savedPortfolio = ''.obs;

  // Platform selection (LinkedIn, X, etc.)
  RxMap<String, bool> selectedPlatforms = {
    'linkedin': true,
    'x': true,
    'github': true,
    'reddit': false,
    'hackernews': true,
    'discord': false,
    'hashnode': true,
  }.obs;

  /// Triggered when user submits initial form and hits "Generate Questions"
  void generateQuestions() async {
    final basePrompt = {
      "title": titleController.text,
      "description": descriptionController.text,
      "github": githubController.text.isEmpty ? null : githubController.text,
      "live_link": liveLinkController.text.isEmpty ? null : liveLinkController.text,
      "linkedin": linkedinController.text,
      "portfolio": portfolioController.text,
    };

    // TODO: Replace with actual LLM API call (for now: mock questions)
    clarifyingQuestions.value = [
      "What problem does this solve?",
      "Who is it for?",
      "What makes this unique?",
      "How long did it take to build?",
      "What tech stack did you use?"
    ];

    // Navigate to the question UI
    Get.toNamed('/questions');
  }

  void updateAnswer(int index, String answer) {
    questionAnswers[index] = answer;
  }

  void resetAll() {
    titleController.clear();
    descriptionController.clear();
    githubController.clear();
    liveLinkController.clear();
    linkedinController.clear();
    portfolioController.clear();
    selectedImages.value = List.filled(4, null);
    clarifyingQuestions.clear();
    questionAnswers.clear();
    selectedPlatforms.updateAll((key, value) => false);
  }

  @override
  void onClose() {
    // Clean up controllers
    titleController.dispose();
    descriptionController.dispose();
    githubController.dispose();
    liveLinkController.dispose();
    linkedinController.dispose();
    portfolioController.dispose();
    super.onClose();
  }


Future<void> savePreferences() async {
  final prefs = await SharedPreferences.getInstance();
  await prefs.setString('linkedin', linkedinController.text);
  await prefs.setString('portfolio', portfolioController.text);
  await prefs.setStringList(
    'selectedPlatforms',
    selectedPlatforms.entries.where((e) => e.value).map((e) => e.key).toList(),
  );
}

Future<void> loadPreferences() async {
  final prefs = await SharedPreferences.getInstance();
  linkedinController.text = prefs.getString('linkedin') ?? '';
  portfolioController.text = prefs.getString('portfolio') ?? '';

  final savedPlatforms = prefs.getStringList('selectedPlatforms') ?? [];
  selectedPlatforms.updateAll((key, value) => savedPlatforms.contains(key));
}

}

```

### question_controller.dart
```dart

import 'package:get/get.dart';
import '../models/question_model.dart';
import 'project_controller.dart';

class QuestionController extends GetxController {
  final ProjectController projectController = Get.find();

  RxList<QuestionModel> questions = <QuestionModel>[].obs;
  RxInt currentIndex = 0.obs;

  void loadQuestionsFromProject() {
    questions.value = projectController.clarifyingQuestions
        .map((q) => QuestionModel(question: q))
        .toList();
  }

  void updateAnswer(String text) {
    questions[currentIndex.value].answer = text;
  }

  void goToNext() {
    if (currentIndex.value < questions.length - 1) {
      currentIndex.value++;
    } else {
      // TODO: Proceed to next step - send to LLM
      Get.toNamed('/result');
    }
  }

  void goToPrevious() {
    if (currentIndex.value > 0) {
      currentIndex.value--;
    }
  }
}

```

### main.dart
```dart
// Project Sharer - Flutter App with GetX & MVC Support

import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:shared_preferences/shared_preferences.dart';

import 'bindings/project_binding.dart';
import 'views/project_input_screen.dart';
import 'views/question_screen.dart';
import 'views/result_screen.dart';
import 'views/api_setup_screen.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  final SharedPreferences prefs = await SharedPreferences.getInstance();

  final hasApiKey = prefs.getString('geminiKey')?.isNotEmpty ?? false;
  runApp(ProjectSharerApp(initialRoute: hasApiKey ? '/' : '/setup'));
}

class ProjectSharerApp extends StatelessWidget {
  final String initialRoute;
  ProjectSharerApp({required this.initialRoute});

  @override
  Widget build(BuildContext context) {
    return GetMaterialApp(
      title: 'Project Sharer',
      theme: ThemeData.dark(),
      debugShowCheckedModeBanner: false,
      initialBinding: ProjectBinding(),
      initialRoute: initialRoute,
      getPages: [
        GetPage(name: '/', page: () => ProjectInputScreen(tokenCount: 0)),
        GetPage(name: '/questions', page: () => QuestionScreen()),
        GetPage(name: '/result', page: () => ResultScreen()),
        GetPage(name: '/setup', page: () => ApiSetupScreen()),
      ],
    );
  }
}

```

### question_model.dart
```dart
class QuestionModel {
  final String question;
  String answer;

  QuestionModel({required this.question, this.answer = ''});

  factory QuestionModel.fromJson(Map<String, dynamic> json) {
    return QuestionModel(question: json['question']);
  }

  Map<String, dynamic> toJson() {
    return {
      'question': question,
      'answer': answer,
    };
  }
}

```

### api_service.dart
```dart
// services/api_service.dart using Gemini SDK with streaming + image + token tracking

import 'dart:async';
import 'dart:convert';
import 'package:google_generative_ai/google_generative_ai.dart';
import 'package:shared_preferences/shared_preferences.dart';

class ApiService {
  static Future<Stream<Map<String, String>>> generatePlatformContentStream({
    required String title,
    required String description,
    required List<String> questions,
    required List<String> answers,
    required List<String> platforms,
    required List<String> base64Images, // <=== added image input
  }) async {
    final prefs = await SharedPreferences.getInstance();
    final apiKey = prefs.getString('geminiKey') ?? '';

    final model = GenerativeModel(model: 'gemini-2.5-flash', apiKey: apiKey);
    final List<Map<String, String>> qaPairs = List.generate(
      questions.length,
      (index) =>
          answers[index] != ""
              ? {"question": questions[index], "answer": answers[index]}
              : {},
    );

    final prompt = '''
Here is a project with the following information:
- Title: $title
- Description: $description
- Q&A:
${qaPairs.map((e) => "Q: ${e['question']}\nA: ${e['answer']}").join("\n\n")}

Generate markdown-wrapped post content for the following platforms, one per section:
${platforms.join(", ")}

Format the output like:
```linkedin
(no markdown formatting)
```
```x
(no markdown formatting)
```
''';

    final parts = <Part>[TextPart(prompt)]
      ..addAll(base64Images.map((b64) => DataPart('image/jpeg', base64Decode(b64))));

    final content = Content('user', parts);
    final stream = model.generateContentStream([content]);

    final controller = StreamController<Map<String, String>>();
    final regex = RegExp(r'```(\w+)\n([\s\S]*?)```', dotAll: true);
    final yielded = <String>{};
    String buffer = '';
    bool counted = false;

    stream.listen(
      (response) async {
        final text = response.text;
        if (text != null) {
          buffer += text;

          for (final match in regex.allMatches(buffer)) {
            final platform = match.group(1)!;
            final content = match.group(2)!.trim();

            if (!yielded.contains(platform)) {
              yielded.add(platform);
              controller.add({platform: content});
            }
          }
        }

        // âœ… Update token count (once, at end or first chunk with metadata)
        if (!counted && response.usageMetadata != null) {
          counted = true;
          final used = response.usageMetadata?.totalTokenCount ?? 0;
          final prefs = await SharedPreferences.getInstance();
          final oldCount = prefs.getInt('tokenCount') ?? 0;
          await prefs.setInt('tokenCount', oldCount + used);
        }
      },
      onError: controller.addError,
      onDone: controller.close,
      cancelOnError: true,
    );

    return controller.stream;
  }
}

```

### api_setup_screen.dart
```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:promoten/views/project_input_screen.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'package:google_generative_ai/google_generative_ai.dart';

class ApiSetupScreen extends StatefulWidget {
  @override
  _ApiSetupScreenState createState() => _ApiSetupScreenState();
}

class _ApiSetupScreenState extends State<ApiSetupScreen> {
  final TextEditingController apiController = TextEditingController();
  final RxInt tokenCount = 0.obs;
  final RxBool loading = false.obs;
  final RxString errorMessage = ''.obs;

  Future<bool> testApiKey(String key) async {
    try {
      final model = GenerativeModel(model: 'gemini-pro', apiKey: key);
      final response = await model.generateContent([
        Content('user',  [TextPart("Say hello")])
      ]);
      final text = response.text?.toLowerCase() ?? '';
      tokenCount.value = response.usageMetadata?.totalTokenCount ?? 0;
      return text.contains("hello") || text.isNotEmpty;
    } catch (e) {
      return false;
    }
  }

  Future<void> saveApiKeyAndProceed() async {
    final key = apiController.text.trim();
    if (key.isEmpty) {
      errorMessage.value = "API key cannot be empty";
      return;
    }

    loading.value = true;
    errorMessage.value = '';

    final isValid = await testApiKey(key);

    if (isValid) {
      final prefs = await SharedPreferences.getInstance();
      await prefs.setString('geminiKey', key);
      loading.value = false;
      Get.off(()=>ProjectInputScreen(tokenCount: tokenCount.value)); // Navigate to project screen
    } else {
      loading.value = false;
      errorMessage.value = "Invalid API key. Please try again.";
    }
  }

  @override
  void initState() {
    super.initState();
    _loadTokenCount();
  }

  Future<void> _loadTokenCount() async {
    final prefs = await SharedPreferences.getInstance();
    tokenCount.value = prefs.getInt('tokenCount') ?? 0;
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text("Setup Gemini API")),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Obx(() => Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                TextField(
                  controller: apiController,
                  decoration: InputDecoration(labelText: 'Enter Gemini API Key'),
                ),
                SizedBox(height: 16),
                ElevatedButton(
                  onPressed: loading.value ? null : saveApiKeyAndProceed,
                  child: loading.value
                      ? CircularProgressIndicator(color: Colors.white)
                      : Text("Validate & Save"),
                ),
                SizedBox(height: 16),
                if (errorMessage.isNotEmpty)
                  Text(errorMessage.value, style: TextStyle(color: Colors.red)),
                SizedBox(height: 24),
                Text("Tokens Used: ${tokenCount.value}"),
              ],
            )),
      ),
    );
  }
}

```

### project_input_screen.dart
```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../controllers/project_controller.dart';

class ProjectInputScreen extends StatelessWidget {
  final controller = Get.find<ProjectController>();
  final int tokenCount;
  @override
  ProjectInputScreen({required this.tokenCount});
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Project Sharer')),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: ListView(
          children: [
            TextField(
              controller: controller.titleController,
              decoration: InputDecoration(labelText: 'Project Title'),
            ),
            SizedBox(height: 10),
            TextField(
              controller: controller.descriptionController,
              decoration: InputDecoration(labelText: 'Description'),
              maxLines: 4,
            ),
            SizedBox(height: 10),
            TextField(
              controller: controller.githubController,
              decoration: InputDecoration(labelText: 'GitHub Link (optional)'),
            ),
            TextField(
              controller: controller.liveLinkController,
              decoration: InputDecoration(labelText: 'Live Link (optional)'),
            ),
            SizedBox(height: 20),
            Obx(
              () => ExpansionTile(
                initiallyExpanded:
                    controller.savedLinkedIn.value.isEmpty ||
                    controller.savedPortfolio.value.isEmpty,
                title: Text('Optional Social Links'),
                children: [
                  TextField(
                    controller: controller.linkedinController,
                    decoration: InputDecoration(labelText: 'LinkedIn URL'),
                  ),
                  TextField(
                    controller: controller.portfolioController,
                    decoration: InputDecoration(labelText: 'Portfolio URL'),
                  ),
                ],
              ),
            ),
            SizedBox(height: 20),
            Text("Select Platforms"),
            Obx(
              () => Wrap(
                spacing: 10,
                children:
                    controller.selectedPlatforms.keys.map((platform) {
                      return FilterChip(
                        label: Text(platform),
                        selected: controller.selectedPlatforms[platform]!,
                        onSelected: (selected) {
                          controller.selectedPlatforms[platform] = selected;
                        },
                      );
                    }).toList(),
              ),
            ),
            SizedBox(height: 30),
            ElevatedButton(
              onPressed: controller.generateQuestions,
              child: Text("Generate Clarifying Questions"),
            ),
          ],
        ),
      ),
    );
  }
}

```

### question_screen.dart
```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../controllers/question_controller.dart';

class QuestionScreen extends StatelessWidget {
  final controller = Get.put(QuestionController());

  @override
  Widget build(BuildContext context) {
    controller.loadQuestionsFromProject();

    return Scaffold(
      appBar: AppBar(title: Text("Answer Clarifying Questions")),
      body: Obx(() {
        final question = controller.questions[controller.currentIndex.value];
        final progress = (controller.currentIndex.value + 1) / controller.questions.length;

        return Padding(
          padding: const EdgeInsets.all(20.0),
          child: Column(
            children: [
              LinearProgressIndicator(
                value: progress,
                backgroundColor: Colors.grey[800],
                color: Theme.of(context).colorScheme.secondary,
              ),
              SizedBox(height: 30),
              Text(
                question.question,
                style: TextStyle(fontSize: 18),
                textAlign: TextAlign.center,
              ),
              SizedBox(height: 20),
              TextField(
                onChanged: controller.updateAnswer,
                controller: TextEditingController(text: question.answer),
                maxLines: 4,
                decoration: InputDecoration(
                  hintText: "Type your answer...",
                  border: OutlineInputBorder(),
                ),
              ),
              SizedBox(height: 30),
              Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  if (controller.currentIndex.value > 0)
                    ElevatedButton(
                      onPressed: controller.goToPrevious,
                      child: Text("Back"),
                    ),
                  ElevatedButton(
                    onPressed: controller.goToNext,
                    child: Text(
                      controller.currentIndex.value == controller.questions.length - 1
                          ? "Submit"
                          : "Next",
                    ),
                  ),
                ],
              )
            ],
          ),
        );
      }),
    );
  }
}

```

### result_screen.dart
```dart
// views/result_screen.dart

import 'package:flutter/material.dart';
import 'package:get/get.dart';
import '../controllers/project_controller.dart';
import '../controllers/question_controller.dart';
import '../services/api_service.dart';
import 'widgets/platform_card.dart';

class ResultScreen extends StatefulWidget {
  @override
  _ResultScreenState createState() => _ResultScreenState();
}

class _ResultScreenState extends State<ResultScreen> {
  final projectController = Get.find<ProjectController>();
  final questionController = Get.find<QuestionController>();
  final RxMap<String, String> platformContent = <String, String>{}.obs;

  @override
  void initState() {
    super.initState();
    _startStreaming();
  }

  void _startStreaming() async {
    final selectedPlatforms = projectController.selectedPlatforms
        .entries
        .where((e) => e.value)
        .map((e) => e.key)
        .toList();

    final stream =  await ApiService.generatePlatformContentStream(
      title: projectController.titleController.text,
      description: projectController.descriptionController.text,
      questions: questionController.questions.map((q) => q.question).toList(),
      answers: questionController.questions.map((q) => q.answer).toList(),
      platforms: selectedPlatforms,
      base64Images: projectController.base64Images,
    );


     await for (final chunk in stream){
       platformContent.addAll(chunk);
     }
    
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text("Generated Posts")),
      body: Obx(() => platformContent.isEmpty
          ? Center(child: CircularProgressIndicator())
          : ListView(
              scrollDirection: Axis.horizontal,
              children: platformContent.entries.map((entry) {
                return PlatformCard(
                  platform: entry.key,
                  content: entry.value,
                );
              }).toList(),
            )),
    );
  }
}

```

